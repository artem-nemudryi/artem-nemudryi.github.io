<!DOCTYPE html>
<html lang="en" data-dark="false">
  {% include head.html %}
  <body>
    {% include header.html %}

    <!-- Swup container -->
    <main id="swup" class="transition-fade">
      {% include content.html content=content %}
    </main>

    {% include footer.html %}

    <!-- AOS -->
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css">
    <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>

    <!-- Swup -->
    <script src="https://unpkg.com/swup@4"></script>

    <!-- Swup + AOS + active-nav + mobile-nav-collapse integration -->
    <script>
      (function () {

        /* ---------- AOS ---------- */
        function initAOS() {
          if (!window.AOS) return;
          AOS.init({
            duration: 450,
            once: true,
            offset: 40,
            easing: "ease-out",
          });
          AOS.refreshHard();
        }

        /* ---------- Active nav underline ---------- */
        function updateActiveNav() {
          const path = window.location.pathname.replace(/index\.html$/, "");
          document.querySelectorAll("header nav a").forEach((a) => {
            const href = new URL(a.getAttribute("href"), window.location.origin)
              .pathname.replace(/index\.html$/, "");
            if (href === path) a.setAttribute("aria-current", "page");
            else a.removeAttribute("aria-current");
          });
        }

        /* ---------- Close mobile nav (checkbox menu) ---------- */
        function closeMobileNav() {
          const toggle = document.querySelector("header .nav-toggle");
          if (toggle) toggle.checked = false;
        }

        document.addEventListener("DOMContentLoaded", () => {
          initAOS();
          updateActiveNav();
          closeMobileNav();
        });

        /* Close menu immediately when a nav link is tapped */
        document.addEventListener("click", (e) => {
          const a = e.target.closest("header nav a");
          if (a) closeMobileNav();
        });

        /* ---------- Swup ---------- */
        const swup = new Swup({
          containers: ["#swup"],
          linkSelector: ['a[href^="/"]', 'a[href^="./"]', 'a[href^="../"]']
            .map((s) => s + ":not([data-no-swup])")
            .join(","),

          ignoreVisit: function (url, { el } = {}) {
            const href = (el && el.getAttribute && el.getAttribute("href")) || url;

            if (href && href.includes("#")) return true;
            if (href && /\.(pdf|zip|png|jpg|jpeg|gif|svg)$/i.test(href)) return true;
            if (el && el.hasAttribute && el.hasAttribute("download")) return true;
            if (el && el.getAttribute && el.getAttribute("target") === "_blank") return true;
            if (href && /^(mailto:|tel:)/i.test(href)) return true;

            return false;
          },
        });

        swup.hooks.on("page:view", () => {
          initAOS();
          updateActiveNav();
          closeMobileNav();
        });

      })();
    </script>
  </body>
</html>
